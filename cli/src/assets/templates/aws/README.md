# {{ workflow_name }}

This project was generated by the Switchboard CLI.

## Prerequisites

- Python 3.11+
- Terraform
- An AWS account with credentials configured

## Setup for Administrators

Before a developer can deploy the project, an administrator must create an IAM role with the necessary permissions. This ensures that developers do not need IAM creation privileges.

1.  **Create the IAM Policy:**

    Create an IAM policy using the contents of the `iam_policy.json` file in this directory. You can do this through the AWS Management Console or with the AWS CLI:

    ```bash
    aws iam create-policy --policy-name switchboard-policy --policy-document file://iam_policy.json
    ```

2.  **Create the IAM Role:**

    Create an IAM role that the Lambda functions will assume. This role must have a trust relationship with the Lambda service.

    ```bash
    aws iam create-role --role-name switchboard-role --assume-role-policy-document '{
        "Version": "2012-10-17",
        "Statement": [
            {
                "Effect": "Allow",
                "Principal": {
                    "Service": "lambda.amazonaws.com"
                },
                "Action": "sts:AssumeRole"
            }
        ]
    }'
    ```

3.  **Attach the Policy to the Role:**

    Attach the policy you created to the new role.

    ```bash
    aws iam attach-role-policy --role-name switchboard-role --policy-arn <your-policy-arn>
    ```

    Replace `<your-policy-arn>` with the ARN of the policy you created in the first step.

4.  **Provide the Role ARN to the Developer:**

    The developer will need the ARN of the role you just created to deploy the project. You can get the ARN with the following command:

    ```bash
    aws iam get-role --role-name switchboard-role --query 'Role.Arn' --output text
    ```

## AWS Configuration

Before you can deploy the project, you need to configure your AWS credentials.

You will need an access key and secret key from your administrator.

    ```bash
    aws configure
    ```

Your administrator should grant you permissions to manage Lambda, SQS, and DynamoDB resources. 
The specific permissions required are listed in the "Developer IAM Policy" section below.

## Developer IAM Policy

An administrator must attach a policy with the following permissions to your IAM user or role. This policy grants the minimum permissions required to deploy and manage the project resources using Terraform.

```json
{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Sid": "ManageLambdaAndEventSources",
            "Effect": "Allow",
            "Action": [
                "lambda:CreateFunction",
                "lambda:DeleteFunction",
                "lambda:GetFunction",
                "lambda:UpdateFunctionCode",
                "lambda:UpdateFunctionConfiguration",
                "lambda:CreateEventSourceMapping",
                "lambda:DeleteEventSourceMapping",
                "lambda:GetEventSourceMapping",
                "lambda:UpdateEventSourceMapping",
                "lambda:TagResource"
            ],
            "Resource": "arn:aws:lambda:*:<aws-account-id>:function:switchboard-*"
        },
        {
            "Sid": "ManageSQS",
            "Effect": "Allow",
            "Action": [
                "sqs:CreateQueue",
                "sqs:DeleteQueue",
                "sqs:GetQueueAttributes",
                "sqs:SetQueueAttributes",
                "sqs:TagQueue"
            ],
            "Resource": "arn:aws:sqs:*:<aws-account-id>:switchboard-*"
        },
        {
            "Sid": "ManageDynamoDB",
            "Effect": "Allow",
            "Action": [
                "dynamodb:CreateTable",
                "dynamodb:DeleteTable",
                "dynamodb:DescribeTable",
                "dynamodb:TagResource"
            ],
            "Resource": "arn:aws:dynamodb:*:<aws-account-id>:table/Switchboard*"
        },
        {
            "Sid": "PassRoleForLambda",
            "Effect": "Allow",
            "Action": "iam:PassRole",
            "Resource": "arn:aws:iam::<aws-account-id>:role/switchboard-role"
        }
    ]
}
```

__________________________________________________________

# Quick Start

## Project layout

You successfully ran the `sb new` command and depending on what language you chose, your project should now look something like this:

```
[project root]
   ├── executor
   │   ├── executor.py
   │   ├── tasks.py
   │   └── requirements.txt
   ├── workflow
   │   ├── workflow.py
   │   └── requirements.txt
   ├── .gitignore
   ├── iam_policy.json
   ├── README.md
   └── terraform/
```

The `workflow` and `executor` directories will contain the source code for the workflow and executor lambda functions.

## Implementing your workflow

The workflow is where you will implement your orchestration logic. Trigger or execute your business logic using the `tasks` file in the executor directory.

## Packaging, Deployment, and Teardown
Once you have added your tasks and orchestration logic, you will need to package your workflow for deployment.
```
sb package
```

After packaging your project you can deploy it using the deploy command.
```
sb deploy
```

To remove your workflow from production and destroy the cloud components it consists of, use the teardown command.
```
sb teardown
```



